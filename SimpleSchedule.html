<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Simple Schedule</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
  </head>
  <body>

	<p><div id="errorMessages"></div></p>

    <p><button type="button" id="button-new" onclick="">NEW</button></p>

    <p>
    <form onsubmit="return false;" > <!-- return false prevents default page re-load behavoir  -->
        <input class="searchInput" value="Initial Value" placeholder="Search">
        <button onClick="searchAppointments($(this).parent().find('.searchInput').val())">Search</button>
    </form>
    </p>

    <p><div id="appsTable"></div></p>

    <script type="text/javascript">

      function buildTable( apps )
      {
        var table = $('<table/>').addClass("searchTable");
        var header = $('<tr/>');
        var dateHeader = $('<th/>').text('DATE');
        var timeHeader = $('<th/>').text('Time');
        var descHeader = $('<th/>').text('DESCRIPTION');
        header.append(dateHeader).append(timeHeader).append(descHeader);
        table.append(header);

        apps.forEach( function( app, index )
        {
          var row = $("<tr/>");
          var date = $("<td/>").text(app.date).css("text-align","center");
          var time = $("<td/>").text(app.time).css("text-align","right").addClass("pad");
          var desc = $("<td/>").text(app.desc);
          row.append(date).append(time).append(desc);
          table.append(row);
        } );

        table.css("width","100%").css("border","1px solid black");
        table.find("th").css("border","1px solid black").css("text-align","left").css("padding","5px");
        table.find("td").css("border","1px solid black").css("padding","5px");
        table.find("td.pad").css("padding","0px 10px 0px 0px");
        dateHeader.css("width","75");
        timeHeader.css("width","75");

        return table;
      }

      function updateTable( apps )
      {
        console.log("updateTable: apps = " + apps );

        var table = buildTable( apps );

        $("#appsTable").html(table);
      }

      function handleAjaxError( jqXHR, textStatus, errorThrown )
      {
        console.log("ajaxError: textStatus = " + textStatus );
        console.log("ajaxError: errorThrown = " + errorThrown );

        $("#errorMessages").text("Communication Error: " + textStatus );
      }

      function clearPage()
      {
        $("#errorMessages").contents().remove();
        $("#appsTable").children().remove();
      }

      function searchAppointments( query )
      {
        console.log("In searchAppointments() > query = " + query );

        clearPage();

        getAppointments( query );
      }

      function getAppointments( query )
      {
        query = query || '';

        console.log("getAppointments: query = " + query );

        $.ajax( { url: "schedules.json",
                  dataType: 'json',
                  data: { getAppointments: query },
                  success: updateTable,
                  error: handleAjaxError } );
      }

      $(document).ready( function()
      {
        console.log("In $(document).ready()" );

        getAppointments();
      } );

    </script>

  </body>
</html>
